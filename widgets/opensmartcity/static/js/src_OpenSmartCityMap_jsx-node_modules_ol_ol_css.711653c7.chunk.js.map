{"version":3,"file":"static/js/src_OpenSmartCityMap_jsx-node_modules_ol_ol_css.711653c7.chunk.js","mappings":";4TAQA,MAQMA,EAAUC,OAAOC,aAAeC,EAAAA,YAEtC,MAAMC,UAAyBJ,EAAQK,WAAAA,GAAA,SAAAC,WAAA,KAyEnCC,cAAgB,CAACC,EAAIC,KACjB,MAAMC,EAAS,IAAKC,KAAKF,MAAMC,QAC/BA,EAAOF,GAAMC,EACbE,KAAKC,SAAS,CACVF,SACAG,OAAQT,EAAiBU,YAAYH,KAAKF,MAAMM,OAAQL,IAC1D,EACJ,KAmCFM,gBAAkB,IAAML,KAAKM,kBAAmB,CAlHhD,oBAAOC,GACH,MAAO,CACHV,GAAI,sBAEJW,OAAQ,gBACRC,YAAa,YACbC,YAAa,UAEbC,eAAgB,mBAChBC,QAAS,mBACTC,SAAU,CAAC,CACPC,KAAM,SACNC,OAAQ,CACJ,CACID,KAAM,SACNE,MAAO,eACPC,KAAM,WACNC,SAAS,GAEb,CACIJ,KAAM,cACNE,MAAO,OACPG,OAAQ,iBAEZ,CACIH,MAAO,WACPF,KAAM,WACNG,KAAM,WACNG,QAAS,iBAEb,CACIN,KAAM,WACNE,MAAO,YACPC,KAAM,YAEV,CACID,MAAO,aACPF,KAAM,YACNG,KAAM,SACNI,KAAM,EACNC,IAAK,GACLJ,QAAS,MAIrBK,gBAAiB,CACbC,MAAO,OACPC,OAAQ,IACRC,SAAU,YAEdC,QAAS,mDAEjB,CAGApB,aAAAA,GACI,OAAOd,EAAiBc,eAC5B,CAEA,kBAAOJ,CAAYC,EAAQL,GACvB,OAAO6B,OAAOC,KAAKzB,GAAQ0B,KAAIjC,IAC3B,MAAMkC,EAAM3B,EAAOP,GACnB,MAAO,CACHmC,UAAWD,EAAIE,OAAOC,YAAY,GAClCC,SAAUJ,EAAIE,OAAOC,YAAY,GACjCE,KAAML,EAAIM,OAAOD,KACjBE,MAAOvC,EAAOF,GAAME,EAAOF,GAAI0C,IAAM,KACrCzB,KAAMiB,EAAIM,OAAOvB,MAAmC,kBAApBiB,EAAIM,OAAOvB,KAAqBiB,EAAIM,OAAOvB,KAAKd,KAAKwC,MAAMC,QAAQC,OAASX,EAAIM,OAAOvB,KAAK6B,GAAOZ,EAAIM,OAAOvB,MAAQ,GACzJ,GAET,CAWA,sBAAMR,GACF,MAAMsC,EAAU,gCAAAC,OAAmC7C,KAAKF,MAAMgD,OAAOC,UAOrE,GALI/C,KAAK4C,YAAc5C,KAAK4C,aAAeA,IACvC5C,KAAKwC,MAAMC,QAAQO,OAAOC,kBAAkBjD,KAAK4C,WAAY5C,KAAKK,uBAC5DL,KAAKwC,MAAMC,QAAQO,OAAOE,kBAAkB,GAADL,OAAI7C,KAAK4C,WAAWO,QAAQ,kBAAmB,IAAG,MAAMnD,KAAKJ,eAC9GI,KAAK4C,WAAa,MAEa,OAA/B5C,KAAKF,MAAMgD,OAAOC,eAAoDK,IAA/BpD,KAAKF,MAAMgD,OAAOC,UAA0B/C,KAAK4C,aAAeA,EAAY,CACnH5C,KAAK4C,WAAaA,EAClB,MAAMxC,QAAeJ,KAAKwC,MAAMC,QAAQO,OAAOK,oBAAoB,QAAQ,iBAADR,OAAmB7C,KAAKF,MAAMgD,OAAOC,SAAQ,sBAAAF,OAAsB7C,KAAKF,MAAMgD,OAAOC,SAAQ,YACjKhD,QAAeC,KAAKwC,MAAMC,QAAQO,OAAOM,UAAU,GAADT,OAAI7C,KAAK4C,WAAWO,QAAQ,kBAAmB,IAAG,OAE1GnD,KAAKC,SAAS,CACVG,SACAL,SACAG,OAAQT,EAAiBU,YAAYC,EAAQL,KAC9CwD,gBACOvD,KAAKwC,MAAMC,QAAQO,OAAOQ,gBAAgB,gCAADX,OAAiC7C,KAAKF,MAAMgD,OAAOC,UAAY/C,KAAKK,uBAC7GL,KAAKwC,MAAMC,QAAQO,OAAOS,eAAe,GAADZ,OAAI7C,KAAK4C,WAAWO,QAAQ,kBAAmB,IAAG,MAAMnD,KAAKJ,cAAc,GAEjI,CACJ,CAEA,oBAAO8D,GACH,MAAO,gBACX,CAEA,uBAAMC,GACFC,MAAMD,0BACA3D,KAAKM,kBACf,CAIA,0BAAMuD,GACE7D,KAAK4C,mBACC5C,KAAKwC,MAAMC,QAAQO,OAAOC,kBAAkBjD,KAAK4C,WAAY5C,KAAKK,uBAClEL,KAAKwC,MAAMC,QAAQO,OAAOc,iBAAiB,GAADjB,OAAI7C,KAAK4C,WAAWO,QAAQ,kBAAmB,IAAG,MAAMnD,KAAKJ,eAC7GI,KAAK4C,WAAa,KAE1B,CAEAmB,eAAAA,GACI/D,KAAKM,kBACT,CAEA0D,gBAAAA,CAAiBxB,GACboB,MAAMI,iBAAiBxB,GACvB,MAAMyB,GAAUC,EAAAA,EAAAA,KAACC,EAAAA,EAAG,CAChBnB,OAAQhD,KAAKwC,MAAMC,QAAQO,OAC3BnD,GAAE,OAAAgD,OAAS7C,KAAKwC,MAAM3C,IACtBK,OAAQF,KAAKF,MAAMI,QAAU,GAC7BkE,SAAUpE,KAAKF,MAAMgD,OAAOsB,WAGhC,OAAKpE,KAAKF,MAAMgD,OAAOuB,OAIhBJ,EAHIjE,KAAKsE,YAAYL,EAIhC,EAGJxE,EAAiB8E,UAAY,CACzB9B,QAAS+B,IAAAA,OACTC,UAAWD,IAAAA,OACXE,MAAOF,IAAAA,OACPG,KAAMH,IAAAA,QAGV,SAAeI,EAAAA,EAAAA,aAnKAC,KAAA,CACXZ,QAAS,CACLa,QAAS,OACTtD,MAAO,OACPC,OAAQ,WA+JhB,EAAkCsD,EAAAA,EAAAA,WAAUtF,4OCzJ5C,MAAMuF,EAAO,2BAAAnC,OAA8BoC,mBAAmB,kZAIxDC,EAAO,2BAAArC,OAA8BoC,mBAAmB,wnBAI9D,MAAME,UAAcC,EAAAA,UAChB1F,WAAAA,CAAY8C,GACRoB,MAAMpB,GAENxC,KAAKF,MAAQ,CACTkC,UAAW,EACXG,SAAW,EACXjC,OAAW,IAAIF,KAAKwC,MAAMtC,QAC1BmF,UAAW,EACXC,SAAW,GAGftF,KAAKuF,QAASC,EAAAA,EAAAA,YAClB,CAqCAC,kBAAAA,CAAmB3D,GAAM,IAAD4D,EACpB,MAAMC,GAASC,EAAAA,EAAAA,IAAW,CAACC,WAAW7F,KAAKF,MAAMkC,WAAa,GAAI6D,WAAW7F,KAAKF,MAAMqC,UAAY,KAEpG,GAAsB,QAAlBuD,EAAC1F,KAAKF,MAAMI,cAAM,IAAAwF,IAAjBA,EAAmBI,OACpB,OAAO,GAEX,IAAIC,EAEJ,GAAK/F,KAAKwC,MAAM4B,SAGT,CAEH,MAAM4B,GAASJ,EAAAA,EAAAA,IAAW,CAAC5F,KAAKF,MAAMI,OAAO,GAAG8B,UAAWhC,KAAKF,MAAMI,OAAO,GAAGiC,WAChF4D,GAASE,EAAAA,EAAAA,IAAeD,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,GACpE,MALID,GAASE,EAAAA,EAAAA,IAAeN,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,IAoBpE,OAZA3F,KAAKF,MAAMI,OAAOgG,SAAQ,CAACC,EAAOC,KAC9B,IAAKA,GAAKpG,KAAKwC,MAAM4B,SACjB,OAEJ,MAAM4B,GAASJ,EAAAA,EAAAA,IAAW,CAACO,EAAMnE,UAAWmE,EAAMhE,YAClDkE,EAAAA,EAAAA,IAAON,EAAQ,CAACC,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,IAAI,IAIhElE,EAAIwE,UAAUC,IAAIR,EAAQjE,EAAI0E,WAGvB1E,EAAIwE,UAAUG,UAAY,CACrC,CAEAC,eAAAA,GACI,IAAIC,EAAQ3G,KAAKwC,MAAM4B,SAAW,EAAI,EAClCwC,EAAQ5G,KAAKwC,MAAM4B,SAAW,EAAIyB,WAAW7F,KAAKF,MAAMkC,WAAa,GACrE6E,EAAO7G,KAAKwC,MAAM4B,SAAW,EAAIyB,WAAW7F,KAAKF,MAAMqC,UAAY,GAOvE,OANAnC,KAAKF,MAAMI,OAAOgG,SAAQC,IACtBS,GAAST,EAAMnE,UACf6E,GAAQV,EAAMhE,SACdwE,GAAO,KAGJf,EAAAA,EAAAA,IAAW,CAACgB,EAAQD,EAAOE,EAAOF,GAC7C,CAEAG,cAAAA,CAAeC,EAAOC,GAElB,MAAMC,EAAUD,EAAOE,QAAQ,oBAAiB9D,EAC5CpD,KAAKmH,IAAIC,KAAKC,sBAAsBN,GAAOO,GAAKA,IACpD,GAAIL,EAAS,CACTjH,KAAKuH,WAAaC,aAAaxH,KAAKuH,WACpC,MAAME,EAAU,CACZC,KAAMX,EAAM,GACZY,IAAKZ,EAAM,GACXa,KAAMX,EAAQY,IAAI,SAEtB7H,KAAKC,SAAS,CAAEwH,WACpB,MACIzH,KAAKuH,WAAaC,aAAaxH,KAAKuH,WACpCvH,KAAKuH,UAAYO,YAAW,IAAM9H,KAAKC,SAAS,CAAEwH,QAAS,QAAS,IAE5E,CAEAM,SAAAA,GAMI,MAAMpC,GAASC,EAAAA,EAAAA,IAAW,CAACC,WAAW7F,KAAKF,MAAMkC,WAAa,GAAI6D,WAAW7F,KAAKF,MAAMqC,UAAY,KAE/FnC,KAAKmH,MAGNnH,KAAKmH,IAAM,CAAC,EACZnH,KAAKmH,IAAIa,aAAe,IAAIC,EAAAA,EAC5BjI,KAAKmH,IAAIe,aAAe,IAAID,EAAAA,EAE5BjI,KAAKmH,IAAIgB,YAAc,IAAIC,EAAAA,GAAM,CAC7BC,MAAO,IAAIC,EAAAA,EAA2C,CAClDC,OAAQ,CAAC,GAAK,IACdC,aAAc,WACdC,aAAc,SACdC,QAAS,IACTC,IAAK3D,MAIbhF,KAAKmH,IAAIyB,UAAY,IAAIR,EAAAA,GAAM,CAC3BC,MAAO,IAAIC,EAAAA,EAA2C,CAClDC,OAAQ,CAAC,GAAK,IACdC,aAAc,WACdC,aAAc,SACdC,QAAS,IACTC,IAAKzD,MAIblF,KAAKmH,IAAI0B,YAAc,IAAIC,EAAAA,EAAY,CACnCC,OAAQ/I,KAAKmH,IAAIe,aACjBxD,MAAO1E,KAAKmH,IAAIyB,YAGpB5I,KAAKmH,IAAIC,KAAO,IAAIjD,EAAAA,EAAI,CACpB6C,OAAQhH,KAAKwC,MAAM3C,IAAM,MACzBmJ,OAAQ,CACJ,IAAIC,EAAAA,EAAK,CAAEF,OAAQ,IAAI5B,EAAAA,IACvB,IAAI2B,EAAAA,EAAY,CACZC,OAAQ/I,KAAKmH,IAAIa,aACjBtD,MAAO1E,KAAKmH,IAAIgB,cAEpBnI,KAAKmH,IAAI0B,aAEbK,KAAM,IAAIC,EAAAA,GAAK,CAAExD,SAAQyD,KAAM,OAGnCpJ,KAAKmH,IAAIkC,OAAS,IAAIC,EAAAA,EAAQ,CAC1BC,SAAU,IAAIC,EAAAA,EAAM7D,GACpB7E,KAAM2I,EAAAA,KAAKC,EAAE,eAGjB1J,KAAKmH,IAAIa,aAAa2B,WAAW3J,KAAKmH,IAAIkC,QAE1CrJ,KAAKmH,IAAIC,KAAKwC,GAAG,eAAeC,IAC5B,GAAIA,EAAIC,SAEJ,YADA9J,KAAKF,MAAM2H,SAAWzH,KAAKC,SAAS,CAAEwH,QAAS,QAGnD,MAAMV,EAAQ/G,KAAKmH,IAAIC,KAAK2C,cAAcF,EAAIG,eAC9ChK,KAAK8G,eAAeC,EAAO8C,EAAIG,cAAchD,OAAO,IAGxDhH,KAAKmH,IAAIC,KAAKwC,GAAG,eAAeK,IAC5B,MAAMlD,EAAQ/G,KAAKmH,IAAIC,KAAK2C,cAAcE,EAAMD,eAC1C/C,EAAUjH,KAAKmH,IAAIC,KAAKC,sBAAsBN,GAAOO,GAAKA,IAC5DtH,KAAKwC,MAAM0H,UAAYjD,GACvBjH,KAAKwC,MAAM0H,SAASjD,EAAQY,IAAI,QACpC,KAMR7H,KAAKmH,IAAIe,aAAaiC,QAEtB,IAAK,IAAIC,EAAI,EAAGA,EAAIpK,KAAKF,MAAMI,OAAO4F,OAAQsE,IAAK,CAC/C,MAAMjE,EAAQnG,KAAKF,MAAMI,OAAOkK,GAC1BnD,EAAU,IAAIqC,EAAAA,EAAQ,CACxBC,SAAU,IAAIC,EAAAA,GAAM5D,EAAAA,EAAAA,IAAW,CAACO,EAAMnE,UAAWmE,EAAMhE,YACvDrB,KAAMqF,EAAMrF,OAEVuJ,EAAW,IAAIjC,EAAAA,GAAM,CACvBC,MAAO,IAAIC,EAAAA,EAA2C,CAClDC,OAAQ,CAAC,GAAK,IACdC,aAAc,WACdC,aAAc,SACdC,QAAS,IACTC,IAAKzD,IAET0C,KAAM,IAAI0C,EAAAA,EAAK,CACX1C,MAAO2C,KAAKC,MAAoB,GAAdrE,EAAM7D,OAAc,IAAImI,WAAatE,EAAM/D,KAC7DsI,MAAO,IACPC,KAAM,IAAIC,EAAAA,EAAK,CAAEC,MAAO,gBAIhC5D,EAAQ6D,SAAST,GAEjBrK,KAAKmH,IAAIe,aAAayB,WAAW1C,EACrC,CAEAjH,KAAKmH,IAAIkC,OAAO0B,YAAY,IAAIvB,EAAAA,EAAM7D,IACtC3F,KAAKmH,IAAIC,KAAK4D,QAAQ,IAAI7B,EAAAA,GAAK,CAAExD,OAAQ3F,KAAK0G,kBAAmB0C,KAAMpJ,KAAKyF,mBAAmBzF,KAAKmH,IAAIC,QAC5G,CAEAzD,iBAAAA,GACI3D,KAAKwC,MAAMQ,OAAOiI,kBACbC,MAAKnJ,GACF/B,KAAKC,SAAS,CACV+B,UAAWD,EAAIM,OAAOL,UACtBG,SAAWJ,EAAIM,OAAOF,WACvB,SAAAgJ,EAAA,OAAyB,QAAnBA,EAAAnL,KAAKuF,OAAO6F,eAAO,IAAAD,OAAA,EAAnBA,EAAqBE,eAAgBrL,KAAK+H,WAAW,KAC1E,CAEAuD,kBAAAA,GACQtL,KAAKuF,OAAO6F,SACZpL,KAAKuF,OAAO6F,QAAQG,cAAgBvL,KAAKF,MAAMwF,UAC/CtF,KAAKuF,OAAO6F,QAAQC,eAAiBrL,KAAKF,MAAMuF,YAE3CrF,KAAKmH,IAMNnH,KAAKC,SAAS,CACVqF,SAAUtF,KAAKuF,OAAO6F,QAAQG,YAC9BlG,UAAWrF,KAAKuF,OAAO6F,QAAQC,eAChC,IAAMrL,KAAKmH,IAAIC,KAAKoE,eARvBxL,KAAKC,SAAS,CACVqF,SAAUtF,KAAKuF,OAAO6F,QAAQG,YAC9BlG,UAAWrF,KAAKuF,OAAO6F,QAAQC,eAChC,IAAMvD,YAAW,IAAM9H,KAAK+H,aAAa,MAQxD,CAEA0D,aAAAA,GACI,OAAKzL,KAAKF,MAAM2H,SAGTvD,EAAAA,EAAAA,KAAA,OAEHQ,MAAO,CACHhD,SAAU,WACViG,IAAK3H,KAAKF,MAAM2H,QAAQE,IACxBD,KAAM1H,KAAKF,MAAM2H,QAAQC,KACzBmD,MAAO,OACPa,QAAS,UACTC,gBAAiB,OACjBC,aAAc,GAChBC,SAED7L,KAAKF,MAAM2H,QAAQG,MAXhB,WAHG,IAgBf,CAEAkE,MAAAA,GAOI,OANIC,KAAKC,UAAUhM,KAAKwC,MAAMtC,UAAY6L,KAAKC,UAAUhM,KAAKF,MAAMI,SAAWF,KAAKmH,KAChFW,YAAW,IACP9H,KAAKC,SAAS,CAAEC,OAAQ,IAAIF,KAAKwC,MAAMtC,UAAW,SAAA+L,EAAA,OAC3B,QAAnBA,EAAAjM,KAAKuF,OAAO6F,eAAO,IAAAa,OAAA,EAAnBA,EAAqBV,cAAevL,KAAK+H,WAAW,KAAG,KAG5D,EACH7D,EAAAA,EAAAA,KAAA,OACIgI,IAAKlM,KAAKuF,OAEV1F,GAAIG,KAAKwC,MAAM3C,IAAM,MACrB6E,MAAO,CACHjD,OAAQ,OACRD,MAAO,OACP2K,SAAU,WALV,OAQRnM,KAAKyL,gBAEb,EAWJ,2BClUa,IAAInE,EAAE8E,EAAQ,MAASC,EAAEC,OAAOC,IAAI,iBAAiBC,EAAEF,OAAOC,IAAI,kBAAkBE,EAAE7K,OAAO8K,UAAUC,eAAeC,EAAEtF,EAAEuF,mDAAmDC,kBAAkB1C,EAAE,CAAC2C,KAAI,EAAGb,KAAI,EAAGc,QAAO,EAAGC,UAAS,GAChP,SAASC,EAAEC,EAAEC,EAAEC,GAAG,IAAIC,EAAEC,EAAE,CAAC,EAAEC,EAAE,KAAKC,EAAE,KAAiF,IAAIH,UAAhF,IAASD,IAAIG,EAAE,GAAGH,QAAG,IAASD,EAAEL,MAAMS,EAAE,GAAGJ,EAAEL,UAAK,IAASK,EAAElB,MAAMuB,EAAEL,EAAElB,KAAckB,EAAEX,EAAEiB,KAAKN,EAAEE,KAAKlD,EAAEuC,eAAeW,KAAKC,EAAED,GAAGF,EAAEE,IAAI,GAAGH,GAAGA,EAAEQ,aAAa,IAAIL,KAAKF,EAAED,EAAEQ,kBAAe,IAASJ,EAAED,KAAKC,EAAED,GAAGF,EAAEE,IAAI,MAAM,CAACM,SAASvB,EAAEpL,KAAKkM,EAAEJ,IAAIS,EAAEtB,IAAIuB,EAAEjL,MAAM+K,EAAEM,OAAOjB,EAAExB,QAAQ,CAAC0C,EAAQC,SAASvB,EAAEsB,EAAQE,IAAId,EAAEY,EAAQG,KAAKf,mBCPxWgB,EAAOJ,QAAU,EAAjBI","sources":["OpenSmartCityMap.jsx","components/Map.js","../node_modules/react/cjs/react-jsx-runtime.production.min.js","../node_modules/react/jsx-runtime.js"],"sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withStyles, withTheme } from '@mui/styles';\r\n\r\nimport { VisRxWidget } from '@iobroker/vis-2-widgets-react-dev';\r\n\r\nimport Map from './components/Map';\r\n\r\nconst styles = () => ({\r\n    content: {\r\n        display: 'flex',\r\n        width: '100%',\r\n        height: '100%',\r\n    },\r\n});\r\n\r\nconst Generic = window.visRxWidget || VisRxWidget;\r\n\r\nclass OpenSmartCityMap extends Generic {\r\n    static getWidgetInfo() {\r\n        return {\r\n            id: 'tplOpenSmartCityMap',\r\n\r\n            visSet: 'opensmartcity',\r\n            visSetLabel: 'set_label', // Label of widget set\r\n            visSetColor: '#dcca19', // color of a widget set\r\n\r\n            visWidgetLabel: 'OpenSmartCityMap',  // Label of widget\r\n            visName: 'OpenSmartCityMap',\r\n            visAttrs: [{\r\n                name: 'common',\r\n                fields: [\r\n                    {\r\n                        name: 'noCard',\r\n                        label: 'without_card',\r\n                        type: 'checkbox',\r\n                        default: false,\r\n                    },\r\n                    {\r\n                        name: 'widgetTitle',\r\n                        label: 'name',\r\n                        hidden: '!!data.noCard',\r\n                    },\r\n                    {\r\n                        label: 'instance',\r\n                        name: 'instance',\r\n                        type: 'instance',\r\n                        adapter: 'opensmartcity',\r\n                    },\r\n                    {\r\n                        name: 'hideHome',\r\n                        label: 'hide_home',\r\n                        type: 'checkbox',\r\n                    },\r\n                    {\r\n                        label: 'zoom_level',\r\n                        name: 'zoomLevel',\r\n                        type: 'slider',\r\n                        min: -1,\r\n                        max: 17,\r\n                        default: 0,\r\n                    },\r\n                ],\r\n            }],\r\n            visDefaultStyle: {\r\n                width: '100%',\r\n                height: 300,\r\n                position: 'relative',\r\n            },\r\n            visPrev: 'widgets/opensmartcity/img/prev_opensmartcity.png',\r\n        };\r\n    }\r\n\r\n    // eslint-disable-next-line class-methods-use-this\r\n    getWidgetInfo() {\r\n        return OpenSmartCityMap.getWidgetInfo();\r\n    }\r\n\r\n    static buildPoints(things, values) {\r\n        return Object.keys(things).map(id => {\r\n            const obj = things[id];\r\n            return {\r\n                longitude: obj.native.coordinates[0],\r\n                latitude: obj.native.coordinates[1],\r\n                unit: obj.common.unit,\r\n                value: values[id] ? values[id].val : '--',\r\n                name: obj.common.name && typeof obj.common.name === 'object' ? (obj.common.name[this.props.context.lang] || obj.common.name.en) : (obj.common.name || ''),\r\n            };\r\n        });\r\n    }\r\n\r\n    onDataUpdated = (id, state) => {\r\n        const values = { ...this.state.values };\r\n        values[id] = state;\r\n        this.setState({\r\n            values,\r\n            points: OpenSmartCityMap.buildPoints(this.state.things, values),\r\n        });\r\n    };\r\n\r\n    async propertiesUpdate() {\r\n        const subscribed = `system.adapter.opensmartcity.${this.state.rxData.instance}`;\r\n        // unsubscribe from old\r\n        if (this.subscribed && this.subscribed !== subscribed) {\r\n            this.props.context.socket.unsubscribeObject(this.subscribed, this.onPointsChanged);\r\n            await this.props.context.socket.unsubscribeStates(`${this.subscribed.replace('system.adapter.', '')}.*`, this.onDataUpdated);\r\n            this.subscribed = null;\r\n        }\r\n        if (this.state.rxData.instance !== null && this.state.rxData.instance !== undefined && this.subscribed !== subscribed) {\r\n            this.subscribed = subscribed;\r\n            const things = await this.props.context.socket.getObjectViewSystem('state', `opensmartcity.${this.state.rxData.instance}.`, `opensmartcity.${this.state.rxData.instance}.\\u9999`);\r\n            const values = await this.props.context.socket.getStates(`${this.subscribed.replace('system.adapter.', '')}.*`);\r\n\r\n            this.setState({\r\n                things,\r\n                values,\r\n                points: OpenSmartCityMap.buildPoints(things, values),\r\n            }, async () => {\r\n                await this.props.context.socket.subscribeObject(`system.adapter.opensmartcity.${this.state.rxData.instance}`, this.onPointsChanged);\r\n                await this.props.context.socket.subscribeState(`${this.subscribed.replace('system.adapter.', '')}.*`, this.onDataUpdated);\r\n            });\r\n        }\r\n    }\r\n\r\n    static getI18nPrefix() {\r\n        return 'opensmartcity_';\r\n    }\r\n\r\n    async componentDidMount() {\r\n        super.componentDidMount();\r\n        await this.propertiesUpdate();\r\n    }\r\n\r\n    onPointsChanged = () => this.propertiesUpdate();\r\n\r\n    async componentWillUnmount() {\r\n        if (this.subscribed) {\r\n            await this.props.context.socket.unsubscribeObject(this.subscribed, this.onPointsChanged);\r\n            await this.props.context.socket.unsubscribeState(`${this.subscribed.replace('system.adapter.', '')}.*`, this.onDataUpdated);\r\n            this.subscribed = null;\r\n        }\r\n    }\r\n\r\n    onRxDataChanged() {\r\n        this.propertiesUpdate();\r\n    }\r\n\r\n    renderWidgetBody(props) {\r\n        super.renderWidgetBody(props);\r\n        const content = <Map\r\n            socket={this.props.context.socket}\r\n            id={`map_${this.props.id}`}\r\n            points={this.state.points || []}\r\n            hideHome={this.state.rxData.hideHome}\r\n        />;\r\n\r\n        if (!this.state.rxData.noCard) {\r\n            return this.wrapContent(content);\r\n        }\r\n\r\n        return content;\r\n    }\r\n}\r\n\r\nOpenSmartCityMap.propTypes = {\r\n    context: PropTypes.object,\r\n    themeType: PropTypes.string,\r\n    style: PropTypes.object,\r\n    data: PropTypes.object,\r\n};\r\n\r\nexport default withStyles(styles)(withTheme(OpenSmartCityMap));\r\n","import PropTypes from 'prop-types';\r\n\r\nimport 'ol/ol.css';\r\nimport { Map, View, Feature } from 'ol';\r\nimport { createOrUpdate, extend } from 'ol/extent';\r\nimport { Tile, Vector as LayerVector } from 'ol/layer';\r\nimport {\r\n    Icon, Style, Fill,\r\n    Text,\r\n} from 'ol/style';\r\nimport { OSM, Vector as VectorSource } from 'ol/source';\r\nimport { Point } from 'ol/geom';\r\nimport { /* toLonLat, */ fromLonLat } from 'ol/proj';\r\n\r\nimport { Component, createRef } from 'react';\r\n\r\nimport { I18n } from '@iobroker/adapter-react-v5';\r\n\r\nconst HomeSVG = `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\">\r\n    <path fill=\"#00F\" d=\"M360-440h80v-110h80v110h80v-190l-120-80-120 80v190Zm120 254q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z\"/>\r\n</svg>`)}`;\r\n\r\nconst TempSVG = `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"48\" viewBox=\"0 -960 960 960\" width=\"48\">\r\n    <path fill=\"#080\" d=\"M480-120q-75.53 0-128.765-53.235Q298-226.47 298-302q0-49.099 24-91.55Q346-436 388-462v-286q0-38.333 26.765-65.167 26.764-26.833 65-26.833Q518-840 545-813.167q27 26.834 27 65.167v286q42 26 66 68.45 24 42.451 24 91.55 0 75.53-53.235 128.765Q555.53-120 480-120Zm.118-59Q531-179 566.5-214.875 602-250.75 602-302q0-37.81-18-70.405T532-420l-20-9v-319q0-13.6-9.2-22.8-9.2-9.2-22.8-9.2-13.6 0-22.8 9.2-9.2 9.2-9.2 22.8v319l-20 9q-34 15-52 47.595T358-302q0 51.25 35.618 87.125Q429.235-179 480.118-179ZM480-302Z\"/>\r\n</svg>`)}`;\r\n\r\nclass OlMap extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            longitude: 0,\r\n            latitude:  0,\r\n            points:    [...this.props.points],\r\n            mapHeight: 0,\r\n            mapWidth:  0,\r\n        };\r\n\r\n        this.refMap = createRef();\r\n    }\r\n\r\n    // positionReady(position) {\r\n    //     this.setState({\r\n    //         latitude:  position.coords.latitude.toFixed(8),\r\n    //         longitude: position.coords.longitude.toFixed(8),\r\n    //     }, () => this.updateMap());\r\n    // }\r\n\r\n    // getPositionForAddress() {\r\n    //     window.fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(`${this.state.country} ${this.state.city} ${this.state.address}`)}`)\r\n    //         .then(data => data.json())\r\n    //         .then(data => {\r\n    //             let changed = false;\r\n    //\r\n    //             if (!data || !data[0]) {\r\n    //                 window.alert(I18n.t('Nothing found'));\r\n    //                 return;\r\n    //             }\r\n    //\r\n    //             let latitude = parseFloat(this.state.latitude);\r\n    //             if (latitude !== parseFloat(data[0].lat)) {\r\n    //                 latitude = parseFloat(data[0].lat);\r\n    //                 changed = true;\r\n    //             }\r\n    //             let longitude = parseFloat(this.state.longitude);\r\n    //             if (longitude !== parseFloat(data[0].lon)) {\r\n    //                 longitude = parseFloat(data[0].lon);\r\n    //                 changed = true;\r\n    //             }\r\n    //             changed && this.setState({ longitude, latitude }, () =>\r\n    //                 this.updateMap());\r\n    //         })\r\n    //         .catch(e =>\r\n    //             window.alert(I18n.t('Cannot fetch address %s', e)));\r\n    // }\r\n\r\n    calculateZoomLevel(map) {\r\n        const center = fromLonLat([parseFloat(this.state.longitude || 0), parseFloat(this.state.latitude || 0)]);\r\n\r\n        if (!this.state.points?.length) {\r\n            return 17;\r\n        }\r\n        let extent;\r\n\r\n        if (!this.props.hideHome) {\r\n            // Create an empty extent\r\n            extent = createOrUpdate(center[0], center[1], center[0], center[1]);\r\n        } else {\r\n            // take first point as a center\r\n            const pPoint = fromLonLat([this.state.points[0].longitude, this.state.points[0].latitude]);\r\n            extent = createOrUpdate(pPoint[0], pPoint[1], pPoint[0], pPoint[1]);\r\n        }\r\n\r\n        // Extend the extent to include each point\r\n        this.state.points.forEach((point, i) => {\r\n            if (!i && this.props.hideHome) {\r\n                return;\r\n            }\r\n            const pPoint = fromLonLat([point.longitude, point.latitude]);\r\n            extend(extent, [pPoint[0], pPoint[1], pPoint[0], pPoint[1]]);\r\n        });\r\n\r\n        // Fit the map view to the extent of the points\r\n        map.getView().fit(extent, map.getSize());\r\n\r\n        // Return the zoom level of the map after fitting\r\n        return map.getView().getZoom() - 1;\r\n    }\r\n\r\n    calculateCenter() {\r\n        let count = this.props.hideHome ? 0 : 1;\r\n        let longs = this.props.hideHome ? 0 : parseFloat(this.state.longitude || 0);\r\n        let lats = this.props.hideHome ? 0 : parseFloat(this.state.latitude || 0);\r\n        this.state.points.forEach(point => {\r\n            longs += point.longitude;\r\n            lats += point.latitude;\r\n            count++;\r\n        });\r\n\r\n        return fromLonLat([longs / count, lats / count]);\r\n    }\r\n\r\n    displayTooltip(pixel, target) {\r\n        // ignore event if mouse is on control\r\n        const feature = target.closest('.ol-control') ? undefined :\r\n            this.OSM.oMap.forEachFeatureAtPixel(pixel, f => f);\r\n        if (feature) {\r\n            this.hideTimer && clearTimeout(this.hideTimer);\r\n            const tooltip = {\r\n                left: pixel[0],\r\n                top: pixel[1],\r\n                text: feature.get('name'),\r\n            };\r\n            this.setState({ tooltip });\r\n        } else {\r\n            this.hideTimer && clearTimeout(this.hideTimer);\r\n            this.hideTimer = setTimeout(() => this.setState({ tooltip: null }), 500);\r\n        }\r\n    }\r\n\r\n    updateMap() {\r\n        // OPEN STREET MAPS\r\n        // if (window.navigator.geolocation && (!this.state.longitude || !this.state.latitude)) {\r\n        //     window.navigator.geolocation.getCurrentPosition(position => this.positionReady(position));\r\n        // }\r\n\r\n        const center = fromLonLat([parseFloat(this.state.longitude || 0), parseFloat(this.state.latitude || 0)]);\r\n\r\n        if (!this.OSM) {\r\n            // get the coordinates from the browser\r\n\r\n            this.OSM = {};\r\n            this.OSM.markerSource = new VectorSource();\r\n            this.OSM.pointsSource = new VectorSource();\r\n\r\n            this.OSM.markerStyle = new Style({\r\n                image: new Icon(/** @type {olx.style.IconOptions} */ ({\r\n                    anchor: [0.5, 49],\r\n                    anchorXUnits: 'fraction',\r\n                    anchorYUnits: 'pixels',\r\n                    opacity: 0.75,\r\n                    src: HomeSVG,\r\n                })),\r\n            });\r\n\r\n            this.OSM.tempStyle = new Style({\r\n                image: new Icon(/** @type {olx.style.IconOptions} */ ({\r\n                    anchor: [0.5, 49],\r\n                    anchorXUnits: 'fraction',\r\n                    anchorYUnits: 'pixels',\r\n                    opacity: 0.75,\r\n                    src: TempSVG,\r\n                })),\r\n            });\r\n\r\n            this.OSM.pointsLayer = new LayerVector({\r\n                source: this.OSM.pointsSource,\r\n                style: this.OSM.tempStyle,\r\n            });\r\n\r\n            this.OSM.oMap = new Map({\r\n                target: this.props.id || 'map',\r\n                layers: [\r\n                    new Tile({ source: new OSM() }),\r\n                    new LayerVector({\r\n                        source: this.OSM.markerSource,\r\n                        style: this.OSM.markerStyle,\r\n                    }),\r\n                    this.OSM.pointsLayer,\r\n                ],\r\n                view: new View({ center, zoom: 17 }),\r\n            });\r\n\r\n            this.OSM.marker = new Feature({\r\n                geometry: new Point(center),\r\n                name: I18n.t('Your home'),\r\n            });\r\n\r\n            this.OSM.markerSource.addFeature(this.OSM.marker);\r\n\r\n            this.OSM.oMap.on('pointermove', evt => {\r\n                if (evt.dragging) {\r\n                    this.state.tooltip && this.setState({ tooltip: null });\r\n                    return;\r\n                }\r\n                const pixel = this.OSM.oMap.getEventPixel(evt.originalEvent);\r\n                this.displayTooltip(pixel, evt.originalEvent.target);\r\n            });\r\n\r\n            this.OSM.oMap.on('singleclick', event => {\r\n                const pixel = this.OSM.oMap.getEventPixel(event.originalEvent);\r\n                const feature = this.OSM.oMap.forEachFeatureAtPixel(pixel, f => f);\r\n                if (this.props.onSelect && feature) {\r\n                    this.props.onSelect(feature.get('name'));\r\n                }\r\n\r\n                // this.setState({ longitude: lonLat[0], latitude: lonLat[1] }, () => this.updateMap());\r\n            });\r\n        }\r\n        // remove all points from layer\r\n        this.OSM.pointsSource.clear();\r\n        // add all points to the layer\r\n        for (let p = 0; p < this.state.points.length; p++) {\r\n            const point = this.state.points[p];\r\n            const feature = new Feature({\r\n                geometry: new Point(fromLonLat([point.longitude, point.latitude])),\r\n                name: point.name,\r\n            });\r\n            const iconTemp = new Style({\r\n                image: new Icon(/** @type {olx.style.IconOptions} */ ({\r\n                    anchor: [0.5, 49],\r\n                    anchorXUnits: 'fraction',\r\n                    anchorYUnits: 'pixels',\r\n                    opacity: 0.75,\r\n                    src: TempSVG,\r\n                })),\r\n                text: new Text({\r\n                    text: (Math.round(point.value * 10) / 10).toString() + point.unit,\r\n                    scale: 1.2,\r\n                    fill: new Fill({ color: '#004f00' }),\r\n                    // stroke: new Stroke({ color: '0', width: 3 }),\r\n                }),\r\n            });\r\n            feature.setStyle(iconTemp);\r\n\r\n            this.OSM.pointsSource.addFeature(feature);\r\n        }\r\n\r\n        this.OSM.marker.setGeometry(new Point(center));\r\n        this.OSM.oMap.setView(new View({ center: this.calculateCenter(), zoom: this.calculateZoomLevel(this.OSM.oMap) }));\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.props.socket.getSystemConfig()\r\n            .then(obj =>\r\n                this.setState({\r\n                    longitude: obj.common.longitude,\r\n                    latitude:  obj.common.latitude,\r\n                }, () => this.refMap.current?.clientHeight && this.updateMap()));\r\n    }\r\n\r\n    componentDidUpdate(/* prevProps, prevState, snapshot */) {\r\n        if (this.refMap.current &&\r\n            this.refMap.current.clientWidth !== this.state.mapWidth &&\r\n            this.refMap.current.clientHeight !== this.state.mapHeight\r\n        ) {\r\n            if (!this.OSM) {\r\n                this.setState({\r\n                    mapWidth: this.refMap.current.clientWidth,\r\n                    mapHeight: this.refMap.current.clientHeight,\r\n                }, () => setTimeout(() => this.updateMap(), 10));\r\n            } else {\r\n                this.setState({\r\n                    mapWidth: this.refMap.current.clientWidth,\r\n                    mapHeight: this.refMap.current.clientHeight,\r\n                }, () => this.OSM.oMap.updateSize());\r\n            }\r\n        }\r\n    }\r\n\r\n    renderTooltip() {\r\n        if (!this.state.tooltip) {\r\n            return null;\r\n        }\r\n        return <div\r\n            key=\"tooltip\"\r\n            style={{\r\n                position: 'absolute',\r\n                top: this.state.tooltip.top,\r\n                left: this.state.tooltip.left,\r\n                color: '#000',\r\n                padding: '3px 5px',\r\n                backgroundColor: '#fff',\r\n                borderRadius: 5,\r\n            }}\r\n        >\r\n            {this.state.tooltip.text}\r\n        </div>;\r\n    }\r\n\r\n    render() {\r\n        if (JSON.stringify(this.props.points) !== JSON.stringify(this.state.points) && this.OSM) {\r\n            setTimeout(() =>\r\n                this.setState({ points: [...this.props.points] }, () =>\r\n                    this.refMap.current?.clientWidth && this.updateMap()), 100);\r\n        }\r\n\r\n        return [\r\n            <div\r\n                ref={this.refMap}\r\n                key=\"map\"\r\n                id={this.props.id || 'map'}\r\n                style={{\r\n                    height: '100%',\r\n                    width: '100%',\r\n                    overflow: 'hidden',\r\n                }}\r\n            />,\r\n            this.renderTooltip(),\r\n        ];\r\n    }\r\n}\r\n\r\nOlMap.propTypes = {\r\n    id: PropTypes.string,\r\n    socket: PropTypes.object,\r\n    points: PropTypes.array,\r\n    onSelect: PropTypes.func,\r\n    hideHome: PropTypes.bool,\r\n};\r\n\r\nexport default OlMap;\r\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n"],"names":["Generic","window","visRxWidget","VisRxWidget","OpenSmartCityMap","constructor","arguments","onDataUpdated","id","state","values","this","setState","points","buildPoints","things","onPointsChanged","propertiesUpdate","getWidgetInfo","visSet","visSetLabel","visSetColor","visWidgetLabel","visName","visAttrs","name","fields","label","type","default","hidden","adapter","min","max","visDefaultStyle","width","height","position","visPrev","Object","keys","map","obj","longitude","native","coordinates","latitude","unit","common","value","val","props","context","lang","en","subscribed","concat","rxData","instance","socket","unsubscribeObject","unsubscribeStates","replace","undefined","getObjectViewSystem","getStates","async","subscribeObject","subscribeState","getI18nPrefix","componentDidMount","super","componentWillUnmount","unsubscribeState","onRxDataChanged","renderWidgetBody","content","_jsx","Map","hideHome","noCard","wrapContent","propTypes","PropTypes","themeType","style","data","withStyles","styles","display","withTheme","HomeSVG","encodeURIComponent","TempSVG","OlMap","Component","mapHeight","mapWidth","refMap","createRef","calculateZoomLevel","_this$state$points","center","fromLonLat","parseFloat","length","extent","pPoint","createOrUpdate","forEach","point","i","extend","getView","fit","getSize","getZoom","calculateCenter","count","longs","lats","displayTooltip","pixel","target","feature","closest","OSM","oMap","forEachFeatureAtPixel","f","hideTimer","clearTimeout","tooltip","left","top","text","get","setTimeout","updateMap","markerSource","VectorSource","pointsSource","markerStyle","Style","image","Icon","anchor","anchorXUnits","anchorYUnits","opacity","src","tempStyle","pointsLayer","LayerVector","source","layers","Tile","view","View","zoom","marker","Feature","geometry","Point","I18n","t","addFeature","on","evt","dragging","getEventPixel","originalEvent","event","onSelect","clear","p","iconTemp","Text","Math","round","toString","scale","fill","Fill","color","setStyle","setGeometry","setView","getSystemConfig","then","_this$refMap$current","current","clientHeight","componentDidUpdate","clientWidth","updateSize","renderTooltip","padding","backgroundColor","borderRadius","children","render","JSON","stringify","_this$refMap$current2","ref","overflow","require","k","Symbol","for","l","m","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","key","__self","__source","q","c","a","g","b","d","e","h","call","defaultProps","$$typeof","_owner","exports","Fragment","jsx","jsxs","module"],"sourceRoot":""}